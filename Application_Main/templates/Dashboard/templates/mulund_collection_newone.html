
{% load static %}
{% load crispy_forms_tags %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.6">
    <title>Mulund Collections</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.4/examples/navbar-fixed/">

    <!-- Bootstrap core CSS -->
<link href="{% static 'css/stylesheet.css' %}" rel="stylesheet">
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
   

    <style>
      @import url('https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'); 
     
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      body {
        background: url("/static/images/home_img.jpg") 10% 0 no-repeat fixed;
        background-size: 100%;
        }
      
        .anch{
          background-color: white;
          color: darkblue;          
          background:blue;
          padding: 2px 60px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
        }
        .anch:hover, .anch:active {
          background-color: lightblue;
          color: white;
        }
        .anch1{
          background-color: orange;
          color: white;          
          background:blue;
          padding: 2px 65px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
        }
        .anch1:hover, .anch1:active {
          background-color: white;
          color:orange;
        }
        .reorder{
          background-color: orange;
          color: white;          
          background:blue;
          padding: 10px 10px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
        }
        .check{
          background-color: white;
          color: white;          
          background:blue;
          padding: 10px 10px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
        }
         
        .sidenav {
          height:100vh;
          width: 0;
          position: fixed;
          z-index: 1;
          top: 0;
          left: 0;
          background-color: lightblue;
          overflow-x: hidden;
          transition: 0.5s;
          padding-top: 60px;
          margin-top:56px;
          border-radius: 5px;
         
        }
        
        .sidenav a {
          padding: 8px 8px 8px 32px;
          text-decoration: none;
          font-size:20px;
          color:black;
          display: block;
          transition: 0.3s;
        }
        
       
        
        .sidenav .closebtn {
          position: absolute;
          top: 0;
          right: 2px;
          font-size: 20px;
          
        }
        
        @media screen and (max-height: 450px) {
          .sidenav {padding-top: 15px;}
          .sidenav a {font-size: 18px;}
        }

        /* Style the sidenav links and the dropdown button */
.sidenav a, .dropdown-btn {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 20px;
  color: 1px solid black;
  display: block;
  border: none;
  background: none;
  width:100%;
  text-align: left;
  cursor: pointer;
  outline: none;
  margin-top:10px;
  margin-bottom:10px;
}

/* On mouse-over */
.sidenav a:hover, .dropdown-btn:hover {
  color: #f1f1f1;
  background-color: #40B5AD;

}

/* Add an active class to the active dropdown button */


/* Dropdown container (hidden by default). Optional: add a lighter background color and some left padding to change the design of the dropdown content */
.dropdown-container {
  display: none;
  background-color:  #5b5b5d;
  padding-left: 8px;
}

/* Optional: Style the caret down icon */
.fa-caret-down {
  float: right;
  padding-right: 8px;
}
.fa-caret-right {
  float: right;
  padding-right: 8px;
}

    </style>
    <!-- Custom styles for this template -->
    <link href="{% static 'css/navbar-top-fixed.css' %}" rel="stylesheet">
  </head>
  <body>
    {% include 'nav.html' %} 
    <div id="mySidenav" class="sidenav">
			<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a><hr>
			<!-- <a href="{% url 'create_patient'  %}">Create Patients</a> -->
      
			<a href="{% url 'dashboard'  %}">Dashboard<i class="fa fa-caret-right"></i></a>
      <div class="dropdown-divider"></div>

      <button class="dropdown-btn">Medicine<i class="fa fa-caret-down"></i></button>
			<div class="dropdown-container">
        <a href="/list_medicine/">Medicine List</a>
        <div class="dropdown-divider"></div>
        <a href="/add_medicine/">Add Medicine</a>        
      </div>
      <div class="dropdown-divider"></div>

      <button class="dropdown-btn">Staff<i class="fa fa-caret-down"></i></button>
			<div class="dropdown-container">
        <a href="{% url 'allstaff' %}">All Staff</a>            
      </div>
      <div class="dropdown-divider"></div>	
      
      <button class="dropdown-btn">Certificates<i class="fa fa-caret-down"></i></button>
			<div class="dropdown-container">
        <a href="{% url 'addpatient' %}">Bill Invoice</a>
        <div class="dropdown-divider"></div>
        <a href="{% url 'previous_issued_invoice' %}">Previous Issued Invoices</a>
        <div class="dropdown-divider"></div>
        <a href="{% url 'addcertificate' %}">Other Certificates</a>
        <div class="dropdown-divider"></div>
        <a href="{% url 'previous_issued_certificate' %}">Previous Issued Certificates</a>             
      </div>	
      <div class="dropdown-divider"></div>    
			
			<a href="{% url 'pricing' %}">Doctor Fees<i class="fa fa-caret-right"></i></a>
      <div class="dropdown-divider"></div>

      <button class="dropdown-btn">Today's Collection<i class="fa fa-caret-down"></i></button>
			<div class="dropdown-container">
        <a href="{% url 'dombivali_collection' %}">Dombivali Branch</a>
        <div class="dropdown-divider"></div>
        <a href="{% url 'mulund_collection' %}">Mulund Branch</a>                   
      </div>	
      <div class="dropdown-divider"></div>		
			<a href="{% url 'diagnosis_history' %}">Diagnosis History</a>

		</div>
		  <span style="font-size:30px;cursor:pointer;"  onclick="openNav()"><p style="padding: 2px; border: 2px solid darkblue; background:white; color:darkblue; width:50px;"><b> &#9776;</b></p></span>


<main role="main" style="margin-left:200px;">
 
<br><br><br>
  <div class="jumbotron" style="width:1280px;">

    <hr>
    <a href="{% url 'mulund_collection' %}" style="margin-left:10px" class="btn btn-outline-primary btn-lg">All Collections</a>
    <a href="{% url 'mulund_collection_general' %}"style="margin-left:30px" class="btn btn-outline-primary btn-lg">General Collections</a>
    <a href="{% url 'mulund_collection_repeat' %}" style="margin-left:30px" class="btn btn-outline-primary btn-lg">Repeat Medicine Collections</a>
    <a href="{% url 'mulund_collection_courier' %}" style="margin-left:30px" class="btn btn-outline-primary btn-lg">Courier Medicine Collections</a>
    <hr>
    <br>
	<div class="header">{{header}}</div>
    <hr>

	
	<br>
	<div class="display_table">
    <table class='table-new'>
        <thead>
          <tr style="font-size:17px;">
            <th>TOTAL COLLECTION</th>
            <th>AMOUNT COLLECTED TODAY</th> 
            <th>CASH PAYMENT</th>           
            <th>ONLINE PAYMENT</th>
            <th>BALANCE(DUES TODAY)</th>
            <th>ADVANCE (TODAY)</th>
            
			
          </tr>
        </thead>
      
          <tr style="font-size:20px;">
            
            <td>Rs {{ total }}</td>
            <td>Rs {{ sum_paid }}</td>
            <td>Rs {{ sum_cash }}</td>
            <td>Rs {{ sum_online }}</td>
            <td>Rs {{ sum_balance }}</td> 
            <td>Rs {{sum_advance}}</td>         
			
          </tr>
      
    </table>
</div>
<!--End of display table-->
<br><br><br>
<div class="header">{{header1}}</div>
<hr>

<label for="paymentCollector" style="font-size:20px;"><b>Select Payment Collected by :</b></label>
<select id="paymentCollector" style="margin-left:30px; width:200px;" onchange="filterTable()">
  <option selected  disabled >Select Here</option>
  <option value="all">All</option>
  {% for hr in hr_payment %}
  <option value="{{hr}}">{{hr}}</option>
    {% endfor %}
  
  <!-- Add more payment collector options as needed -->
</select>

<div>
  {% comment %} <p>Total Amount: <span id="totalAmount">Rs 0.00</span></p> {% endcomment %}
  <p style="font-size:20px; ">Total Amount Collected <span id="totalAmountPaid" style="font-weight:bolder; margin-left:8px;">&nbsp;&nbsp;&nbsp; Rs&nbsp; 0.00</span></p>
  <p style="font-size:20px; ">Total Cash <span id="totalCash" style="font-weight:bolder; margin-left:126px;">&nbsp;&nbsp;&nbsp; Rs&nbsp; 0.00</span></p>
  <p style="font-size:20px; ">Total Online <span id="totalOnline" style="font-weight:bolder;margin-left:110px;">&nbsp;&nbsp;&nbsp; Rs&nbsp; 0.00</span></p>
  <p style="font-size:20px; ">Total Balance <span id="totalBalance" style="font-weight:bolder;margin-left:100px;">&nbsp;&nbsp;&nbsp; Rs&nbsp; 0.00</span></p>
  <p style="font-size:20px; ">Total Advance <span id="totalAdvance" style="font-weight:bolder;margin-left:93px;">&nbsp;&nbsp;&nbsp; Rs&nbsp; 0.00</span></p>
</div>
<hr>
<div class="display_table" style="width:1230px;">
    <table class='table'>
        <thead>
          <tr style="font-size:17px;">
            <th>CASE PAPER NO.</th>
            <th>NAME</th> 
            <th>TOTAL AMOUNT TODAY</th>           
            <th>AMOUNT PAID TODAY</th>
            <th>CASH</th>
            <th>ONLINE</th>
            <th>TRANSACTION DETAILS</th>
            <th>STATUS</th>
            <th>TYPE</th>
            <th>BALANCE(DUES TODAY)</th>
            <th>PAYMENT COLLECTED BY</th>
            <th class="edit">Edit</th>           
			
          </tr>
        </thead>

        {% for d in amount_names %}
      {% for b in balance_names %}
        {% for a in appointment_status %}
          <tr style="font-size:17px;">
            {% if d.patient.case == a.patientid.case %}
              {% if d.patient.case == b.patient.case %}
                <td class="case-paper" style="text-align:center">{{d.patient.case}}</td>
                <td class="name" style="text-align:center">{{d.patient.name}}</td>
                <td class="total-amount" style="text-align:center">Rs {{d.paid_amount|add:b.balance_amt}}</td>
                <td class="amount-paid" style="text-align:center">Rs {{d.paid_amount}}</td>
                {% if d.cash %}
                  <td class="cash" style="text-align:center">Rs {{d.cash_amount}}</td>
                {% else %}
                  <td class="cash" style="text-align:center">Rs 0</td>
                {% endif %}
                {% if d.online %}
                  <td class="online" style="text-align:center">Rs {{d.online_amount}}</td>
                {% else %}
                  <td class="online" style="text-align:center">Rs 0</td>
                {% endif %}
                <td class="transaction-details" style="text-align:center">{{d.transac_id}}</td>
                {% if d.balance_flag %}
                  <td class="status" style="text-align:center">Paid Balance Today</td>
                {% else %}
                  <td class="status" style="text-align:center">_</td>
                {% endif %}
                <td class="type" style="text-align:center">{{a.stat}}</td>
                {% if b.balance_amt == 0 %}
                  <td class="balance" style="text-align:center" >No Dues</td>
                {% else %}
                  {% if b.balance_amt >= 0 or b.balance_amt >= '0' %}
                    <td class="balance" style="text-align:center;color:#AA0000;"> <b>Rs {{ b.balance_amt }}  &nbsp; BALANCE</b></td>
                  {% else %}
                    <td class="balance" style="text-align:center"><b> Rs <span class="balanceAmt">{{ b.balance_amt }} </span>   ADVANCE</b></td>
                  {% endif %}
                {% endif %}
                <td class="collected-by" style="text-align:center">{{d.collected_by}}</td>
                <td class="edit" style="text-align:center"><a href="{% url 'payment_cancellation' d.patient.id %}" class="btn btn-primary"  title="Delete " onclick="confirmDelete(event)">Delete</a></td>
                {% endif %}
            {% endif %}
          </tr>
        {% endfor %}
      {% endfor %}
    {% endfor %}
      
    </table>
</div>
 
  </div>
</main>
<script>
  function confirmDelete(event) {
    if (!window.confirm("Are you sure you want to delete this Collection Entry?")) {
      event.preventDefault(); // Cancel the link navigation if the user clicks "Cancel"
    }
  }
</script>
<script>
  function filterTable() {
    var selectedType = document.getElementById("paymentCollector").value;
    var table = document.querySelector(".table");
    var rows = table.querySelectorAll("tbody tr");

    // Initialize variables to store totals
    //var totalAmount = 0;
    var totalAmountPaid = 0;
    var totalCash = 0;
    var totalOnline = 0;
    var totalBalance = 0;
    var totalAdvance = 0;

    rows.forEach(function (row) {
      var collectorColumn = row.querySelector(".collected-by");

      if (collectorColumn) {
        if (selectedType === "all" || collectorColumn.innerText === selectedType) {
          // Accumulate totals for the selected collector
         // var totalColumn = row.querySelector(".total-amount");
          var amountPaidColumn = row.querySelector(".amount-paid");
          var cashColumn = row.querySelector(".cash");
          var onlineColumn = row.querySelector(".online");
          var balanceColumn = row.querySelector(".balance");

          // Check if columns are found
          if (amountPaidColumn && cashColumn && onlineColumn && balanceColumn) {
            //var totalValue = parseFloat(totalColumn.innerText.replace('Rs ', '')) || 0;
            var amountPaidValue = parseFloat(amountPaidColumn.innerText.replace('Rs ', '')) || 0;
            var cashValue = parseFloat(cashColumn.innerText.replace('Rs ', '')) || 0;
            var onlineValue = parseFloat(onlineColumn.innerText.replace('Rs ', '')) || 0;

            //totalAmount += totalValue;
            totalAmountPaid += amountPaidValue;
            totalCash += cashValue;
            totalOnline += onlineValue;

            // Check if balance is positive (dues) or negative (advance)
            var balanceValue = parseFloat(balanceColumn.innerText.replace('Rs ', '')) || 0;

            console.log("balance_value",balanceValue)
            var balanceSpan = balanceColumn.querySelector("span");
            console.log("balanceSpan",balanceSpan)
            
            if (balanceSpan) {
              totalAdvance += Math.abs(balanceValue);
            } else {
              totalBalance += balanceValue;
            }
          }
        }

        row.style.display = selectedType === "all" || collectorColumn.innerText === selectedType ? "" : "none";
      } else {
        // Handle the case where the collectorColumn is not found
        console.error("Collector column not found for the row:", row);
      }
    });

    // Display the totals in the frontend
   // document.getElementById("totalAmount").innerText = "Rs " + totalAmount.toFixed(2);
    document.getElementById("totalAmountPaid").innerText = "Rs " + totalAmountPaid.toFixed(2);
    document.getElementById("totalCash").innerText = "Rs " + totalCash.toFixed(2);
    document.getElementById("totalOnline").innerText = "Rs " + totalOnline.toFixed(2);
    document.getElementById("totalBalance").innerText = "Rs " + totalBalance.toFixed(2);
    document.getElementById("totalAdvance").innerText = "Rs " + totalAdvance.toFixed(2);
  }
</script>

<script>
  // Get all elements with the class "balanceAmt"
  var balanceAmtElements = document.getElementsByClassName('balanceAmt');

  // Loop through each element and update its content
  for (var i = 0; i < balanceAmtElements.length; i++) {
    var balanceAmtElement = balanceAmtElements[i];

    // Get the balance amount value as a number
    var balanceAmtValue = Math.abs(parseFloat(balanceAmtElement.innerHTML));

    // Check if the balance amount is negative and format accordingly
    balanceAmtElement.textContent = balanceAmtValue;
  }
</script>

<script>
  function openNav() {
  document.getElementById("mySidenav").style.width = "250px";
  }
  
  function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
  }
  </script>
  <script>
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var i;
    
    for (i = 0; i < dropdown.length; i++) {
      dropdown[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var dropdownContent = this.nextElementSibling;
        if (dropdownContent.style.display === "block") {
          dropdownContent.style.display = "none";
        } else {
          dropdownContent.style.display = "block";
        }
      });
    }
  </script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E30Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</body>
</html>
